{% extends 'layout.html.twig' %}

{% block content %}
    <h1>Carte de randonn√©es</h1>
    <div>
        <form method="POST" action="/Hiking/baliseDisplay">
            {% for land in lands %}
                <div class="landCard">
                    <h3>{{ land.name }}</h3>
                    <p>{{ land.description }}</p>
                    <img src="{{ land.url }}" />
                    {% if land.id in baliseId %}
                        <input class="landChoose" onclick="submit()" type="checkbox" name="land{{ land.id }}" value="{{ land.id }}" checked>                                     
                    {% else %}
                        <input class="landChoose" onclick="submit()" type="checkbox" name="land{{ land.id }}" value="{{ land.id }}">                  
                    {% endif %}
                    <!--<input type="hidden" class="landCoords" value="{{ land.coordinate_X }}, {{ land.coordinate_Y }}">-->
                </div>
            {% endfor %}
        </form>
    </div>
    




    <!--<input type="hidden" id="nbLands" value={{ lands|length }}>-->
    <input type="hidden" id="coordLands" value="{{ coordBalises }}">
    <div class="hikingCard">
        <canvas id ='marsCard' width="500" height="200" style = "background-image: url(/assets/images/mars-rando.png);">
            <div><img id="balise" src="/assets/images/balise.png"></div>
        </canvas>
        <canvas id ='canevas3' width="500" height="200" ></canvas>
    </div>
    <div>
        {% if idPop['id'] != 0  and idPop['id'] in baliseId %}
            <p>DESCRIPTIF POINT D'INTERET</p>
            <h3>{{ idPop.name }}</h3>
            <p>{{ idPop.description }}</p>
        {% endif %}
        
    </div>
    <button id="travel" type="button">Valider votre circuit</button>
    <a href="/home/index">Accueil</a>
{% endblock %}

{% block javascript %}
    <script>
        // transform strin coord in array
        const tabBalise = document.getElementById("coordLands").value;
        const coordsBalises = tabBalise.split(' ');
        for (i=0; i<coordsBalises.length; i++) {
            coordsBalises[i] = coordsBalises[i].split('-');
            coordsBalises[i][0] = parseInt(coordsBalises[i][0]);
            coordsBalises[i][1] = parseInt(coordsBalises[i][1]);
        }
        
        console.log(coordsBalises);
        
        // button circuit
        const btn = document.getElementById("travel");
        btn.addEventListener("click", function() {
            for (i=0; i<coordsBalises.length-1; i++) {
                Line(coordsBalises[i], coordsBalises[i+1]);
        }
        Line(coordsBalises[coordsBalises.length-1], coordsBalises[0])
        });
        

        var c = document.getElementById("marsCard");
        var ctx = c.getContext("2d");

        window.onload = function() {
            var d = document.getElementById("canevas3");
            var ctx = d.getContext("2d");

            for (i=0; i<coordsBalises.length; i++) {
                balise(coordsBalises[i]);
            }
        };

        

        function Line(bal1, bal2) {
            //ctx.fillStyle="#FF8030";
            ctx.beginPath();        
            ctx.moveTo(bal1[0]+10, bal1[1]+20);
            ctx.lineTo(bal2[0]+10, bal2[1]+20);
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#331040';
            ctx.stroke();
        };

        function balise(baliseCoord) {
            var img1 = document.getElementById("balise");
            ctx.drawImage(img1, baliseCoord[0], baliseCoord[1], 20, 20);
        };

        var coords = [];
        var canvas = document.getElementById('canevas3');
        var context = canvas.getContext("2d");
        canvas.addEventListener('click', function (event) {
            coords = [event.layerX, event.layerY];
            //coords layer = coords canvas * 3 
            document.location.href="/Hiking/landDisplay/"+coords[0]+"/"+coords[1];
            //var pixelData = context.getImageData(event.layerX, event.layerY, 1, 1).data;
            //console.log(pixelData);
        });    


    </script>
{% endblock %}
